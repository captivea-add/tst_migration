<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <template id="assets_common" name="cap_maintenance report" inherit_id="web.report_assets_common">
        <xpath expr="." position="inside">
             <link rel='stylesheet' type="text/css" href="/cap_maintenance/static/src/css/report.css"/>
        </xpath>
    </template>

    <!-- TOSA -->
    <template id="report_detailed_work_done_tosa_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="obj">
                <t t-call="cap_maintenance.external_layout_report">
                    <t t-set="detailed_work_done_id" t-value="obj"/>
                    <t t-set="maintenance_request_id" t-value="obj.maintenance_request_id"/>

                     <!-- TITLE -->
                    <h1 class="cap_centered" style="margin-top: 50px; margin-bottom: 50px;"><span t-field="detailed_work_done_id.report_title"/></h1>

                    <!-- BODY -->
                    <div style="width:auto;margin-left:0px;margin-right:0px">
                        <!--   INTERVENTION  -->
                        <t t-call="cap_maintenance.report_detailed_work_done_intervention_part"/>
                        <br/>

                        <!--   CONCERNED UNIT  -->
                        <table class="cap_table cap_bold_border extend cap_5_col" style="width: 100%;">
                            <tr class="colored_background">
                                <td class="cap_field" colspan="5"><span class="cap_section">Equipment<span t-if="maintenance_request_id.equipment_id"  t-field="maintenance_request_id.equipment_id.name" /></span></td>
                            </tr>
                            <tr t-if="maintenance_request_id.equipment_group">
                                <td class="cap_field">Group</td>
                                <td colspan="4">
                                    <span t-field="maintenance_request_id.equipment_group.name" />
                                </td>
                            </tr>
                            <tr t-if="maintenance_request_id.equipment_subgroup">
                                <td class="cap_field">Subgroup</td>
                                <td colspan="4">
                                    <span t-field="maintenance_request_id.equipment_subgroup.name" />
                                </td>
                            </tr>
                            <tr>
                                <td class="cap_field">Vendor</td>
                                <td colspan="4">
                                    <span t-if="maintenance_request_id.equipment_id" t-field="maintenance_request_id.equipment_id.partner_id" t-options='{"widget": "contact", "fields": ["name"], "no_marker": True}'/>
                                </td>
                            </tr>
                            <tr>
                                <td class="cap_field">Serial # of the unit</td>
                                <td colspan="4">
                                    <span t-if="maintenance_request_id.equipment_id"  t-field="maintenance_request_id.equipment_id.serial_no" />
                                </td>
                            </tr>
                            <tr t-if="maintenance_request_id.bus_num">
                                <td class="cap_field">Bus Num</td>
                                <td colspan="4">
                                    <span t-field="maintenance_request_id.bus_num" />
                                </td>
                            </tr>
                        </table>
                        <br/>

                        <!-- WORK DONE / DESCRIPTION -->
                        <table class="cap_table cap_bold_border" style="width: 100%;">
                            <tr>
                                <td>
                                    <h4 class="cap_field">Issue Description</h4>
                                    <span class="text-muted">(Specify the initial information that caused the intervention and the bus number or substation)</span>
                                </td>
                            </tr>
                            <tr class="cap_bottom_border">
                                <td>
                                    <span t-field="detailed_work_done_id.issue_description" />
                                </td>
                            </tr>
                        </table>
                        <table class="cap_table cap_bold_border" style="page-break-before:always;width:100%;">
                            <tr>
                                <td><h4 class="cap_field">Corrective Work Done</h4>
                                    <span class="text-muted">(Specify the report - including software version - at the start of the intervention and at the end of the intervention)</span>
                                </td>
                            </tr>
                            <tr class="cap_bottom_border">
                                <td>
                                    <span t-field="detailed_work_done_id.corrective_work_done" /><br/>
                                </td>
                            </tr>
                        </table>
                        <table class="cap_table cap_bold_border" style="page-break-before:always;width:100%;">
                            <tr>
                                <td><h4 class="cap_field">Validation Work Done</h4>
                                    <span class="text-muted">(Specify how the modifications were validated before the return to operation)</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span t-field="detailed_work_done_id.validation_work_done" /><br/>
                                </td>
                            </tr>
                        </table>
                        <br/>

                        <!-- PICTURES -->
                        <t t-foreach="detailed_work_done_id.picture_attachment_ids" t-as="picture_attachment_id">
                            <t t-set="numero_photo" t-value="picture_attachment_id_index +1"/>
                            <div class="container-fluid text-center">Picture <span t-esc="numero_photo"/></div>
                            <div class="container-fluid text-center" t-field="picture_attachment_id.picture" style="page-break-after:always;" t-options="{'widget': 'image'}"/>
                            <br/>
                        </t>

                        <table class="cap_table cap_bold_border" style="width: 100%;">
                            <tr>
                                <td t-if="detailed_work_done_id.is_customer_signature_required" class="cap_field">Customer Signature</td>
                                <td class="cap_field">Worker Signature</td>
                            </tr>
                            <tr>
                                <td t-if="detailed_work_done_id.is_customer_signature_required">
                                    <span t-field="detailed_work_done_id.customer_signature" t-options="{'widget': 'image'}"/>
                                </td>
                                <td>
                                    <span t-field="detailed_work_done_id.worker_signature" t-options="{'widget': 'image'}"/>
                                </td>
                            </tr>
                        </table>
                        <br/>

                    </div>

                </t>
            </t>
        </t>
    </template>

    <report
        string="Maintenance Detailed Work Done Report"
        id="action_print_detailed_work_done_report_tosa"
        model="maintenance.detailed.report.work.done"
        report_type="qweb-pdf"
        name="cap_maintenance.report_detailed_work_done_tosa_document"
        file="cap_maintenance.report_detailed_work_done_tosa_document"
        print_report_name="'Maintenance Detailed Work Done Report'"
        paperformat="cap_paperformat_maintenance_detailed_work_done"
    />

</odoo>