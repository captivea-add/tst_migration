<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
     <!-- Printable view of a survey (all pages) -->
    <template id="survey_print_pdf" name="Survey">
        <t t-call="survey.layout">
            <div class="wrap">
                <div class="container">

                    <div class="header text-right" style="height: 1cm;">
                        <img t-att-src="image_data_uri(maintenance_request.company_id.logo)" alt="Logo" style="max-height: 100%;"/>
                    </div>

                    <div class="footer text-right mx-auto d-block">
                        <span class="page"/>/<span class="topage"/>
                        <div class="font-weight-bold">HITACHI ABB POWER GRIDS</div>
                    </div>

                    <table class="table" style="width: 100%; border-collapse: collapse;">
                        <tbody style="width: 100%;">
                            <tr style="width: 100%; height: 0.4cm; font-size: x-small; font-weight: bold;">
                                <td style="width: 50%; border-top: 2px solid black; border-right: 1px solid grey;">PREPARED</td>
                                <td style="width: 50%; border-top: 2px solid black;"/>
                            </tr>
                            <tr style="width: 100%;">
                                <td style="width: 50%; border-bottom: 1px solid grey; border-right: 1px solid grey;">
                                    <span t-esc="print_date"/>
                                    <field t-field="maintenance_request.worker_ids" t-options="{'widget': 'many2many'}"/>
                                </td>
                                <td style="width: 50%; border-bottom: 1px solid grey;">
                                    <span t-field="survey.title"/>
                                </td>
                            </tr>
                            <tr style="width: 100%; height: 0.4cm; font-size: x-small; font-weight: bold;">
                                <td colspan="2">ACTIVITY</td>
                            </tr>
                            <tr style="width: 100%; height: 0.4cm;">
                                <td colspan="2" style="border-bottom: 1px solid grey;">
                                    <span t-field="maintenance_request.name"/>
                                </td>
                            </tr>
                            <tr style="width: 100%; height: 0.4cm; font-size: x-small; font-weight: bold;">
                                <td style="border-right: 1px solid grey;">REQUEST NUMBER</td>
                                <td>ADDRESS</td>
                            </tr>
                            <tr style="width: 100%;">
                                <td style="border-bottom: 1px solid grey; border-right: 1px solid grey;">
                                    <spant t-field="maintenance_request.company_request_num"/>
                                </td>
                                <td style="border-bottom: 1px solid grey;">
                                    <div t-field="maintenance_request.working_location_partner_id.street"/>
                                    <div t-field="maintenance_request.working_location_partner_id.street2"/>
                                    <div>
                                        <span t-field="maintenance_request.working_location_partner_id.zip"/>
                                        -
                                        <span t-field="maintenance_request.working_location_partner_id.city"/>
                                    </div>
                                    <div>
                                        <span t-field="maintenance_request.working_location_partner_id.state_id"/>
                                        -
                                        <span t-field="maintenance_request.working_location_partner_id.country_id"/>
                                    </div>
                                </td>
                            </tr>
                            <tr style="width: 100%; height: 0.8cm; border-bottom: 1px solid grey; font-size: small;">
                                <td colspan="2" style="vertical-align: bottom;">Â©Hitachi ABB Power Grids. All rights reserved.</td>
                            </tr>
                            <tr style="width: 100%; height: 0.8cm; border-bottom: 2px solid black;">
                                <td colspan="2"/>
                            </tr>
                        </tbody>
                    </table>

                    <p style="page-break-before:always;"/>

                    <div class='jumbotron mt32'>
                        <h1><span t-field='survey.title'/></h1>
                        <t t-if="survey.description"><div t-field='survey.description' class="oe_no_empty"/></t>
                    </div>
                    <div role="form" class="js_surveyform" t-att-name="'%s' % (survey.id)">
                        <t t-foreach='questions' t-as='question_answer'>

                            <t t-set="question" t-value="question_answer.question_id"/>
                            <t t-set="answers" t-value="question_answer.user_input_line_ids"/>

                            <hr t-if="question.is_page and question != survey.page_ids[0]" />
                            <!-- Affichage d'une section -->
                            <div t-if="question.is_page" class="o_page_header">
                                <h1 t-field='question.title' />
                                <div t-if="question.description" t-field='question.description' class="oe_no_empty"/>
                            </div>
                            <!-- Affichage de la question -->
                            <t t-if="not question.is_page" >
                                <t t-set="prefix" t-value="'%s_%s' % (survey.id, question.id)" />
                                <div class="js_question-wrapper" t-att-id="prefix">
                                    <h2>
                                        <span t-field='question.question' />
                                        <span t-if="question.constr_mandatory" class="text-danger">*</span>
                                    </h2>
                                    <t t-if="question.description"><div class="text-muted oe_no_empty" t-field='question.description'/></t>
                                    <t t-if="question.question_type == 'free_text'"><t t-call="cap_survey_report.free_text"/></t>
                                    <t t-if="question.question_type == 'textbox'"><t t-call="cap_survey_report.textbox"/></t>
                                    <t t-if="question.question_type == 'numerical_box'"><t t-call="cap_survey_report.numerical_box"/></t>
                                    <t t-if="question.question_type == 'date'"><t t-call="cap_survey_report.date"/></t>
                                    <t t-if="question.question_type == 'datetime'"><t t-call="cap_survey_report.datetime"/></t>
                                    <t t-if="question.question_type == 'simple_choice'"><t t-call="cap_survey_report.simple_choice"/></t>
                                    <t t-if="question.question_type == 'multiple_choice'"><t t-call="cap_survey_report.multiple_choice"/></t>
                                    <t t-if="question.question_type == 'matrix'"><t t-call="cap_survey_report.matrix"/></t>
                                    <t t-if="question.question_type == 'sign'"><t t-call="cap_survey_report.signature"/></t>
                                    <t t-if="question.question_type == 'attachment'"><t t-call="cap_survey_report.attachment"/></t>
                                    <div class="js_errzone alert alert-danger" style="display:none;" role="alert"/>
                                </div>
                            </t>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Response widgets -->
    <template id="free_text" name="Free text box">
        <span t-if="answers[0]" t-field="answers[0].value_free_text" />
    </template>

    <template id="textbox" name="Text box">
        <span t-if="answers[0]" t-field="answers[0].value_text" />
    </template>

    <template id="numerical_box" name="Numerical box">
        <span t-if="answers[0]" t-field="answers[0].value_number" />
    </template>

    <template id="date" name="Date box">
        <span t-if="answers[0]" t-field="answers[0].value_date" t-options="{'widget': 'date'}"/>
    </template>

    <template id="datetime" name="DateTime box">
        <span t-if="answers[0]" t-field="answers[0].value_datetime" t-options="{'widget': 'datetime'}"/>
    </template>

    <template id="simple_choice" name="Simple choice">
        <div class="row js_radio">
            <div t-foreach='question.labels_ids' t-as='label' t-attf-class="col-lg-#{question.column_nb}">
                <t t-set="matching_answer" t-value="question_answer.get_user_input_line_for(label)"/>

                <label>
                    <t t-if="matching_answer">
                        <input type="radio" t-att-name="prefix" t-att-value='label.id' checked="checked" />
                        <span t-field='label.value'/>
                    </t>
                    <t t-else="">
                        <input type="radio" t-att-name="prefix" t-att-value='label.id' />
                        <span t-field='label.value'/>
                    </t>
                </label>
            </div>

            <div t-if='question.comments_allowed and question.comment_count_as_answer' class="col-lg-12" >
                <t t-set="comment_answer" t-value="question_answer.get_comment()"/>
                <label>
                    <t t-if="comment_answer">
                        <input type="radio" t-att-name="prefix" checked="checked"/>
                        <span t-field="question.comments_message" />
                        <span t-field="comment_answer.value_text" />
                    </t>
                    <t t-else="">
                        <input type="radio" t-att-name="prefix" />
                        <span t-field="question.comments_message" />
                    </t>
                </label>
            </div>
        </div>
    </template>

    <template id="multiple_choice" name="Multiple choice">
        <div class="row">
            <div t-foreach='question.labels_ids' t-as='label' t-attf-class="col-lg-#{question.column_nb}">
                <t t-set="matching_answer" t-value="question_answer.get_user_input_line_for(label)"/>

                <label>
                    <t t-if="matching_answer">
                        <input type="checkbox" t-att-name="prefix" t-att-value='label.id' checked="checked" />
                        <span t-field='label.value'/>
                    </t>
                    <t t-else="">
                        <input type="checkbox" t-att-name="prefix" t-att-value='label.id' />
                        <span t-field='label.value'/>
                    </t>
                </label>
            </div>

            <div t-if='question.comments_allowed and question.comment_count_as_answer' class="col-lg-12" >
                <t t-set="comment_answer" t-value="question_answer.get_comment()"/>
                <label>
                    <t t-if="comment_answer">
                        <input type="checkbox" t-att-name="prefix" checked="checked"/>
                        <span t-field="question.comments_message" />
                        <span t-field="comment_answer.value_text" />
                    </t>
                    <t t-else="">
                        <input type="checkbox" t-att-name="prefix" />
                        <span t-field="question.comments_message" />
                    </t>
                </label>
            </div>
        </div>
    </template>

    <template id="matrix" name="Matrix">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th> </th>
                    <th t-foreach="question.labels_ids" t-as="col_label"><span t-field="col_label.value" /></th>
                </tr>
            </thead>
            <tbody>
                <tr t-foreach="question.labels_ids_2" t-as="row_label">
                    <th><span t-field="row_label.value" /></th>
                    <td t-foreach="question.labels_ids" t-as="col_label">
                        <t t-set="matching_answer" t-value="question_answer.get_user_input_line_for_matrix(col_label, row_label)"/>
                        <t t-if="matching_answer">
                            <input t-if="question.matrix_subtype == 'simple'" type="radio" t-att-name="'%s_%s' % (prefix, row_label.id)" t-att-value='col_label.id' checked="checked"/>
                            <input t-if="question.matrix_subtype == 'multiple'" type="checkbox" t-att-name="'%s_%s_%s' % (prefix, row_label.id, col_label.id)" t-att-value='col_label.id' checked="checked"/>
                        </t>
                        <t t-else="">
                            <input t-if="question.matrix_subtype == 'simple'" type="radio" t-att-name="'%s_%s' % (prefix, row_label.id)" t-att-value='col_label.id' />
                            <input t-if="question.matrix_subtype == 'multiple'" type="checkbox" t-att-name="'%s_%s_%s' % (prefix, row_label.id, col_label.id)" t-att-value='col_label.id' />
                        </t>
                    </td>
                </tr>
            </tbody>
        </table>
        <div t-if='question.comments_allowed'>
            <span t-field="question.comments_message"/>
            <textarea class="form-control" rows="1" t-att-name="'%s_%s' % (prefix, 'comment')" />
        </div>
    </template>

    <template id="signature" name="Signature Box">
         <img t-if="answers[0]"
              alt="Signature"
              style="width:100%;"
              t-attf-src="data:image/png;base64,#{answers[0].img_sign}"/>
    </template>

    <template id="attachment" name="Attachment Box">
        <t t-if="answers[0]">
            <t t-set="attachment" t-value="answers[0].attachment_id"/>
            <img t-if="attachment"
                 alt="Attachment"
                 style="width:100%;"
                 t-attf-src="data:image/png;base64,#{attachment.datas}"/>
        </t>
    </template>

    <report
        string="Print Survey Report To PDF"
        id="action_print_survey_report"
        model="survey.user_input"
        report_type="qweb-pdf"
        name="cap_survey_report.survey_print_pdf"
        file="cap_survey_report.survey_print_pdf"
        print_report_name="'Survey Report'"
    />
</odoo>